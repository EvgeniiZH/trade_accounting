{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Trade Accounting{% endblock %}</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" defer></script>

    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="{% static 'css/base.css' %}?v=20251123b">
    <link rel="stylesheet" href="{% static 'css/layout.css' %}?v=20251123b">
    <link rel="stylesheet" href="{% static 'css/components/table.css' %}?v=20251123d">
    <link rel="stylesheet" href="{% static 'css/components/form.css' %}?v=20251123b">
    <link rel="stylesheet" href="{% static 'css/components/alerts.css' %}?v=20251123b">
    <link rel="stylesheet" href="{% static 'css/components/checkbox.css' %}?v=20251123b">
    <link rel="stylesheet" href="{% static 'css/components/animation.css' %}?v=20251123b">
    <link rel="stylesheet" href="{% static 'css/login.css' %}?v=20251123b">

    {% if load_create_calculation_css %}
    <link rel="stylesheet" href="{% static 'css/pages/create_calculation.css' %}?v=20251123i">
    <!-- DEBUG: load_create_calculation_css = True -->
    {% else %}
    <!-- DEBUG: load_create_calculation_css = False or not set -->
    {% endif %}

    {% block extra_css %}{% endblock %}

    <!-- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ CSS –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å—á—ë—Ç–∞ -->
    <script>
    (function() {
        var path = window.location.pathname;
        if (path === '/calculations/create/' || (path.match(/^\/calculations\/\d+\/$/))) {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º CSS —Ñ–∞–π–ª
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = '{% static "css/pages/create_calculation.css" %}?v=20251123i';
            document.head.appendChild(link);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ —Å—Ä–∞–∑—É –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è FOUC - –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä
            var style = document.createElement('style');
            style.textContent = '#create-calculation-wrapper #calculation-table { table-layout: auto !important; width: 100% !important; overflow: visible !important; } ' +
                '#create-calculation-wrapper #calculation-table th:nth-child(1), #create-calculation-wrapper #calculation-table td:nth-child(1) { width: auto !important; text-align: center !important; } ' +
                '#create-calculation-wrapper #calculation-table th:nth-child(2), #create-calculation-wrapper #calculation-table td:nth-child(2) { width: auto !important; white-space: normal !important; overflow-wrap: anywhere !important; text-align: left !important; } ' +
                '#create-calculation-wrapper #calculation-table th:nth-child(3), #create-calculation-wrapper #calculation-table td:nth-child(3) { width: auto !important; text-align: right !important; } ' +
                '#create-calculation-wrapper #calculation-table th:nth-child(4), #create-calculation-wrapper #calculation-table td:nth-child(4) { width: auto !important; text-align: center !important; } ' +
                '#create-calculation-wrapper #calculation-table th:nth-child(5), #create-calculation-wrapper #calculation-table td:nth-child(5) { width: auto !important; text-align: center !important; }';
            document.head.appendChild(style);
        }
    })();
    </script>

    <script src="{% static 'js/edit_modal.js' %}?v=20251123b" defer></script>

    <link rel="shortcut icon" href="{% static 'favicon.ico' %}" type="image/x-icon">
</head>
<body>

<!-- –û—Å–Ω–æ–≤–Ω—ã–π –º–∞–∫–µ—Ç: –±–æ–∫–æ–≤–æ–µ –º–µ–Ω—é + –∫–æ–Ω—Ç–µ–Ω—Ç -->
<div class="layout">

    <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
    {% if user.is_authenticated %}
        <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
        <aside class="sidebar">
            <nav>
                <h4 class="sidebar-title">–¢–ò–¢–ê–ù</h4>
                <ul>
                    <li><a href="{% url 'item_list' %}">üì¶ –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</a></li>
                    <li><a href="{% url 'create_calculation' %}">‚ûï –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—á—ë—Ç</a></li>
                    <li><a href="{% url 'calculations_list' %}">üìä –†–∞—Å—á—ë—Ç—ã</a></li>
                    <li><a href="{% url 'calculation_snapshot_list' %}">üìÅ –ê—Ä—Ö–∏–≤</a></li>
                    <li><a href="{% url 'price_history' %}">üìà –ò—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω</a></li>
                    {% if user.is_admin or user.is_superuser %}
                        <li><a href="{% url 'manage_users' %}">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
                    {% endif %}
                    <li>
                        <form action="{% url 'logout' %}" method="post">{% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-outline-danger mt-2">–í—ã–π—Ç–∏</button>
                        </form>
                    </li>
                </ul>
            </nav>
        </aside>
    {% endif %}

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="content-area">
        {% block content %}{% endblock %}

        <!-- üîª –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ñ—É—Ç–µ—Ä -->
        <footer class="text-center text-muted small py-3 mt-auto">
            <hr>
            –¢–ò–¢–ê–ù ¬∑ –¢–æ—Ä–≥–æ–≤—ã–π —É—á—ë—Ç ¬∑ –í–µ—Ä—Å–∏—è 1.0 ¬∑ {{ request.user.username }}
        </footer>
    </main>
</div>
</div>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π -->
<div id="message-container" role="status" aria-live="polite" aria-atomic="true"></div>

<!-- –ü–µ—Ä–µ–¥–∞—á–∞ —Å–æ–æ–±—â–µ–Ω–∏–π Django –≤–æ –≤–Ω–µ—à–Ω–∏–π JS -->
<script>
    window._djangoMessages = [
        {% for message in messages %}
            {
                message: "{{ message|escapejs }}",
                tags: "{{ message.tags }}"
            },
        {% endfor %}
    ];
</script>

<!-- –°–∫—Ä–∏–ø—Ç—ã -->
<script src="{% static 'js/scripts.js' %}" defer></script>
<script src="{% static 'js/messages.js' %}" defer></script>

{% block extra_js %}{% endblock %}

</body>
</html>
