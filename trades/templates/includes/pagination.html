{% load custom_filters %}
<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2 mt-3">
  <form method="get" class="d-flex align-items-center gap-2">
    {# Сохраняем все GET параметры кроме page и page_size #}
    {% if request.GET.search %}
      <input type="hidden" name="search" value="{{ request.GET.search }}">
    {% endif %}
    {% if request.GET.sort %}
      <input type="hidden" name="sort" value="{{ request.GET.sort }}">
    {% endif %}
    {% if request.GET.direction %}
      <input type="hidden" name="direction" value="{{ request.GET.direction }}">
    {% endif %}
    {% if request.GET.sort_by %}
      <input type="hidden" name="sort_by" value="{{ request.GET.sort_by }}">
    {% endif %}
    {% for item_id in request.GET.getlist.items %}
      <input type="hidden" name="items" value="{{ item_id }}">
    {% endfor %}
    {% for key in request.GET.keys %}
      {% if 'quantity_' in key %}
        <input type="hidden" name="{{ key }}" value="{{ request.GET|get_item:key }}">
      {% endif %}
    {% endfor %}
    {% if request.GET.title %}
      <input type="hidden" name="title" value="{{ request.GET.title }}">
    {% endif %}
    {% if request.GET.markup %}
      <input type="hidden" name="markup" value="{{ request.GET.markup }}">
    {% endif %}
    <label class="form-label mb-0 d-flex align-items-center gap-2">
      <span class="text-muted small">На странице:</span>
      <select name="page_size" class="form-select form-select-sm" onchange="this.form.submit()">
        {% for option in page_size_options %}
          <option value="{{ option }}" {% if page_size == option %}selected{% endif %}>{{ option }}</option>
        {% endfor %}
      </select>
    </label>
  </form>

  <nav aria-label="Пагинация">
    <ul class="pagination pagination-sm mb-0">
      <li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
        {% if page_obj.has_previous %}
          <a class="page-link" href="?{% querystring page=page_obj.previous_page_number %}" aria-label="Предыдущая">&laquo;</a>
        {% else %}
          <span class="page-link">&laquo;</span>
        {% endif %}
      </li>
      {% for page_number in page_range %}
        {% if page_number == '…' %}
          <li class="page-item disabled"><span class="page-link">…</span></li>
        {% elif page_number == page_obj.number %}
          <li class="page-item active"><span class="page-link">{{ page_number }}</span></li>
        {% else %}
          <li class="page-item"><a class="page-link" href="?{% querystring page=page_number %}">{{ page_number }}</a></li>
        {% endif %}
      {% endfor %}
      <li class="page-item {% if not page_obj.has_next %}disabled{% endif %}">
        {% if page_obj.has_next %}
          <a class="page-link" href="?{% querystring page=page_obj.next_page_number %}" aria-label="Следующая">&raquo;</a>
        {% else %}
          <span class="page-link">&raquo;</span>
        {% endif %}
      </li>
    </ul>
  </nav>
</div>

