{% extends 'base.html' %}

{% block title %}–°–ø–∏—Å–æ–∫ —Ä–∞—Å—á—ë—Ç–æ–≤{% endblock %}

{% block content %}
    <div class="container my-4">
        <h2 class="mb-4">–°–ø–∏—Å–æ–∫ —Ä–∞—Å—á—ë—Ç–æ–≤</h2>

        <div class="row g-3 align-items-center mb-3">
            <div class="input-group">
                <input type="text" id="search-input" class="form-control" placeholder="üîç –ü–æ–∏—Å–∫ —Ä–∞—Å—á—ë—Ç–∞...">
                <button id="clear-search" class="btn btn-secondary">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
        </div>

        <form method="post" action="{% url 'calculations_list' %}">
            {% csrf_token %}

            <div style="max-height: 500px; overflow-y: auto;" class="border rounded shadow-sm">
                <table class="table table-bordered table-hover mb-0" id="calculation-table">
                    <thead class="table-light position-sticky top-0 z-1">
                    <tr>
                        <th><input type="checkbox" id="select_all"></th>

                        <th>
                            <a href="?sort=title&direction={% if sort_by == 'title' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                                –ù–∞–∑–≤–∞–Ω–∏–µ
                                {% if sort_by == 'title' %}{% if direction == 'asc' %}‚Üë{% else %}‚Üì{% endif %}{% endif %}
                            </a>
                        </th>

                        <th>–ù–∞—Ü–µ–Ω–∫–∞</th>

                        <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>

                        <th> –° –Ω–∞—Ü–µ–Ω–∫–æ–π</th>

                        <th>
                            <a href="?sort=created_at&direction={% if sort_by == 'created_at' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                                –î–∞—Ç–∞ {% if sort_by == 'created_at' %}{% if direction == 'asc' %}‚Üë{% else %}‚Üì
                            {% endif %}{% endif %}
                            </a>
                        </th>

                        <th>–ê–≤—Ç–æ—Ä</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for calc in calculations %}
                        <tr id="calc-{{ calc.id }}">
                            <td><input type="checkbox" name="calc_ids" value="{{ calc.id }}"></td>

                            <td class="calc-title">
                                <a href="{% url 'calculation_detail' calc.id %}" class="text-decoration-none">
                                    {{ calc.title }}
                                </a>
                            </td>
                            <td>{{ calc.markup|floatformat:0 }}</td>
                            <td>{{ calc.total_price_without_markup_calc|floatformat:2 }}</td>
                            <td>{{ calc.calculate_total_price_with_markup|floatformat:2 }}</td>
                            <td>{{ calc.created_at|date:"d.m.Y H:i" }}</td>
                            <td>{{ calc.user.username|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</td>
                            <td>
                                <button type="submit" name="delete_calc" value="{{ calc.id }}"
                                        class="btn btn-danger btn-sm">
                                    –£–¥–∞–ª–∏—Ç—å
                                </button>
                                <a href="{% url 'copy_calculation' calc.id %}" class="btn btn-info btn-sm">
                                    –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>

            <button type="submit" name="export_excel" value="1" class="btn btn-success mt-3">
                –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
            </button>
        </form>
    </div>

    {% load static %}
    <script src="{% static 'js/calculations_list.js' %}" defer></script>
    <link rel="stylesheet" href="{% static 'css/pages/calculations_list.css' %}">


    <!-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–Ω—è—Ç–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ -->
    <script>
        setTimeout(() => {
            const highlighted = document.querySelector('.table-success');
            if (highlighted) {
                highlighted.classList.remove('table-success');
            }
        }, 3000);
    </script>
{% endblock %}
