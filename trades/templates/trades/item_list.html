{% extends 'base.html' %}
{% block title %}–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤{% endblock %}

{% block content %}
    <div class="container my-4">
        <div class="row">
            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Ç–∞–±–ª–∏—Ü–∞ -->
            <div class="col-lg-9 mb-4">
                <h2 class="mb-4 text-primary">üì¶ –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h2>

                <!-- –ü–æ–∏—Å–∫ -->
                <div class="input-group mb-3">
                    <input type="text" id="search-input" class="form-control"
                           placeholder="üîç –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞...">
                    <button type="button" id="clear-search" class="btn btn-outline-secondary">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ -->
                <div class="table-container">
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover" id="item-table">
                            <thead class="table-light">
                            <tr>
                                <th style="width: 50px;">#</th>
                                <th>
                                    <a href="?sort=name&direction={% if sort_by == 'name' and direction == 'asc' %}desc{% else %}asc{% endif %}&search={{ search }}">
                                        –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
                                        {% if sort_by == 'name' %}
                                            {% if direction == 'asc' %}‚Üë{% else %}‚Üì{% endif %}
                                        {% endif %}
                                    </a>
                                </th>
                                <th class="text-end" style="width: 120px;">
                                    <a href="?sort=price&direction={% if sort_by == 'price' and direction == 'asc' %}desc{% else %}asc{% endif %}&search={{ search }}">
                                        –¶–µ–Ω–∞
                                        {% if sort_by == 'price' %}
                                            {% if direction == 'asc' %}‚Üë{% else %}‚Üì{% endif %}
                                        {% endif %}
                                    </a>
                                </th>
                                <th class="text-center" style="width: 160px;">–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for item in items %}
                                <tr id="item-{{ item.id }}">
                                    <td>{{ forloop.counter }}</td>
                                    <td class="item-name">{{ item.name }}</td>
                                    <td class="text-end">{{ item.price|floatformat:2 }} ‚ÇΩ</td>
                                    <td class="text-center">
                                        <div class="d-flex justify-content-center gap-2">
                                            <button type="button"
                                                    class="btn btn-sm btn-outline-primary btn-edit"
                                                    data-id="{{ item.id }}"
                                                    data-name="{{ item.name }}"
                                                    data-price="{{ item.price }}"
                                                    onclick="openEditModal(this)">
                                                ‚úè –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                            </button>


                                            <form method="post" style="display:inline;">
                                                {% csrf_token %}
                                                <input type="hidden" name="delete_item" value="{{ item.id }}">
                                                <button type="submit" class="btn btn-sm btn-outline-danger btn-edit"
                                                        onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä {{ item.name }}?')">
                                                    üóë –£–¥–∞–ª–∏—Ç—å
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Ñ–æ—Ä–º—ã -->
            <div class="col-lg-3 right-column-offset">

                <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ -->
                <h4 class="text-success mb-3">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h4>
                <form method="post" class="mb-4">
                    {% csrf_token %}
                    <div class="mb-3">
                        <input type="text" name="name" class="form-control" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required
                               autocomplete="off">
                    </div>
                    <div class="mb-3">
                        <input type="number" name="price" class="form-control" placeholder="–¶–µ–Ω–∞" step="0.01" min="1"
                               required autocomplete="off">
                    </div>
                    <button type="submit" name="add_item" class="btn btn-success w-100">–î–æ–±–∞–≤–∏—Ç—å</button>
                </form>

                <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
                <h4 class="text-primary mb-3">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ —Ñ–∞–π–ª–∞</h4>
                <form method="post" enctype="multipart/form-data" class="mb-3">
                    {% csrf_token %}
                    <div class="mb-3">
                        <input type="file" name="file" accept=".xlsx, .xls" class="form-control">
                    </div>
                    <button type="submit" name="upload_file" class="btn btn-info text-white w-100">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </form>

                <div class="text-center">
                    <a href="{% url 'download_import_template' %}" class="btn btn-outline-info w-100">
                        ‚¨á –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-block p-4 bg-light border rounded text-center">

        <h5 class="mb-3 text-secondary">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–æ–≤–∞—Ä–∞–º</h5>
        <div class="row justify-content-center">
            <div class="col-md-3">
                <p><strong>–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤:</strong><br> {{ total_items }}</p>
            </div>
            <div class="col-md-3">
                <p><strong>–û–±—â–∞—è —Å—É–º–º–∞:</strong><br> {{ total_price|floatformat:2 }} ‚ÇΩ</p>
            </div>
            <div class="col-md-3">
                <p><strong>–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞:</strong><br> {{ avg_price|floatformat:2 }} ‚ÇΩ</p>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –≠–∫—Å–ø–æ—Ä—Ç (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞) -->
        {#         <a href="{% url 'export_items_excel' %}" class="btn btn-outline-success mt-3">‚¨á –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Excel</a>#}
    </div>
    <!-- üß© –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="editItemForm">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editModalLabel">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}
                        <input type="hidden" id="editItemId">
                        <div class="mb-3">
                            <label for="editItemName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                            <input type="text" id="editItemName" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="editItemPrice" class="form-label">–¶–µ–Ω–∞</label>
                            <input type="number" id="editItemPrice" class="form-control" step="0.01" min="1" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    {% load static %}
    <script src="{% static 'js/search_filter.js' %}" defer></script>
{% endblock %}
